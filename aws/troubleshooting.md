## Troubleshooting

### EC2 smtp 이슈

#### 증상
- EC2 인스턴스상에서 Gmail 발송시 BadCredential 오류 발생

#### 발생 원인(추측)
- AWS 환경변수 오탈자
- Gmail 관리자 계정 전달 및 POP/IMAP 설정 변경
- Gmail 2차 인증 비활성 및 앱 키 삭제
- 보안 수준이 낮은 앱 및 Google 계정
- EC2 환경변수 값 오류
- 전송 이메일에 포함된 이미지 리소스

#### 시도
1. IMAP 미사용 -> 사용 초기 설정 전체 재진행                                     (X)
2. 2차 인증 활성화 및 앱 키 재생성                                               (X)
3. 보안 수준이 낮은 앱 설정 불가 (2022년 5월 30일 구글 서비스 지원 종료)         (X)
4. 도메인 연결 및 Https ACM 인증서 연결                                          (X)
5. Test 케이스 작성 및 환경변수 system.out 체크                                  (X)
6. 이메일 양식 이미지 제거                                                       (X)
7. AWS 환경변수 오탈자 수정 !!!                                                  (O)

#### 해결
- 총 7가지 시도중 오탈자로 인한 오류로 확인...
  휴먼 미스테이크를 가장 먼저 생각하자!!!

### EC2 Target Group 헬스 체크 이슈

#### 증상
  - 타켓 그룹 생성시 아래 포트 번호 할당 (EC2 인스턴스 포트 번호)  
    이후 로드밸런서 연결 시도 -> 헬스 체크 오류 발생 로드밸런서 502 Bad Gateway 에러 발생
  - 할당된 포트 번호
    - 80 : Unhealthy  (X)
    - 443: Unhealthy  (X)

#### 발생 원인(추측)
- 헬스 체크 실패(Unhealthy)로 인해 API call 502 Bad Gateway 응답
  - 평균 API call 3회 시도시 1회 발생

#### 시도
1. 안정적으로 연결 가능한 새로운 포트(8080) 번호 할당
2. 헬스 체크 진행 이후 로드밸런서 안정적으로 동작
   - 실패한 헬스체크 포트 번호 Deregister 처리

#### 해결
- 최종 등록된 포트목록
  - 80: draining                      # nginx 연동시 포트 활성화
  - 443: draining
  - 8080: healthy

### RDS 연동 Issue
#### 증상
- 프로젝트 data.sql INSERT 구문에 작성된 테이블명을 찾지 못하는 이슈 발생

#### 발생 원인(추측)
- 프로젝트 data.sql 파일 INSERT 구문 테이블명 대문자로 작성됨
- RDS Mysql 테이블명은 소문자로 생성됨
  - MySQL은 대소문자를 구분하지 않는 파일 시스템에서 개발되었기 때문에 대소문자 구분을 하지 않는것으로 확인.
  - JPA @Table(name = "대문자 테이블명") 작성했어도 MySQL 특성상 소문자로 테이블 생성됨

#### 시도
- data.sql 파일에 INSERT 구문 테이블명 대문자 -> 소문자 변경

#### 해결
- RDS 배포시 정상동작 확인
